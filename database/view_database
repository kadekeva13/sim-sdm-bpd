/*

 table for view data hr_view_emp_competency 

*/

DELIMITER $$

ALTER ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `hr_view_emp_competency` AS 
SELECT
  `hairisma_bpd`.`hr_emp_competency`.`EMPLOYEE_COMP_ID`    AS `EMPLOYEE_COMP_ID`,
  `hairisma_bpd`.`hr_emp_competency`.`EMPLOYEE_ID`         AS `EMPLOYEE_ID`,
  `hairisma_bpd`.`hr_emp_competency`.`COMPETENCY_ID`       AS `COMPETENCY_ID`,
  `hairisma_bpd`.`hr_emp_competency`.`LEVEL_VALUE`         AS `LEVEL_VALUE`,
  `hairisma_bpd`.`hr_emp_competency`.`SPECIAL_ACHIEVEMENT` AS `SPECIAL_ACHIEVEMENT`,
  `hairisma_bpd`.`hr_emp_competency`.`DATE_OF_ACHVMT`      AS `DATE_OF_ACHVMT`,
  `hairisma_bpd`.`hr_emp_competency`.`HISTORY`             AS `HISTORY`,
  `hairisma_bpd`.`hr_emp_competency`.`PROVIDER_ID`         AS `PROVIDER_ID`,
  `hairisma_bpd`.`hr_emp_competency`.`COMPETENCY_LEVEL_ID` AS `COMPETENCY_LEVEL_ID`,
  `hairisma_bpd`.`hr_emp_competency`.`SCORE_VALUE`         AS `SCORE_VALUE`,
  MAX(`hairisma_bpd`.`hr_emp_competency`.`DATE_OF_ACHVMT`) AS `MAX_DATE_OF_ACHVMT`
FROM (`hr_emp_competency`
   JOIN `hr_view_emp_competency_max` `lastcomp`
     ON (`hairisma_bpd`.`hr_emp_competency`.`EMPLOYEE_ID` = `lastcomp`.`employee_id`
         AND `hairisma_bpd`.`hr_emp_competency`.`COMPETENCY_ID` = `lastcomp`.`COMPETENCY_ID`
         AND `hairisma_bpd`.`hr_emp_competency`.`DATE_OF_ACHVMT` = `lastcomp`.`DATE_OF_ACHVMT`))
GROUP BY `hairisma_bpd`.`hr_emp_competency`.`EMPLOYEE_ID`,`hairisma_bpd`.`hr_emp_competency`.`COMPETENCY_ID`$$

DELIMITER ;


/*

 table for view data hr_view_emp_competency 

*/

DELIMITER $$

ALTER ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `hr_view_emp_competency_max` AS 
SELECT
  `hairisma_bpd`.`hr_emp_competency`.`EMPLOYEE_ID`   AS `employee_id`,
  `hairisma_bpd`.`hr_emp_competency`.`COMPETENCY_ID` AS `COMPETENCY_ID`,
  MAX(`hairisma_bpd`.`hr_emp_competency`.`DATE_OF_ACHVMT`) AS `DATE_OF_ACHVMT`
FROM `hr_emp_competency`
GROUP BY `hairisma_bpd`.`hr_emp_competency`.`EMPLOYEE_ID`,`hairisma_bpd`.`hr_emp_competency`.`COMPETENCY_ID`$$

DELIMITER ;


/*

 table for view data hr_view_max_emp_work_history 

*/

DELIMITER $$

ALTER ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `hr_view_max_emp_work_history` AS (
SELECT
  `hairisma_bpd`.`hr_work_history_now`.`EMPLOYEE_ID` AS `EMPLOYEE_ID`,
  MAX(`hairisma_bpd`.`hr_work_history_now`.`WORK_TO`) AS `MAX_HIS_WT`
FROM `hr_work_history_now`
WHERE `hairisma_bpd`.`hr_work_history_now`.`HISTORY_GROUP` = 0
GROUP BY `hairisma_bpd`.`hr_work_history_now`.`EMPLOYEE_ID`)$$

DELIMITER ;


/*

 table for view data hr_view_work_history_now 

*/

DELIMITER $$

ALTER ALGORITHM =
  UNDEFINED DEFINER = `root`@`localhost` SQL SECURITY DEFINER VIEW `hr_view_work_history_now` AS
  (SELECT
    `whn`.`WORK_HISTORY_NOW_ID` AS `WORK_HISTORY_NOW_ID`,
    `whn`.`EMPLOYEE_ID` AS `EMPLOYEE_ID`,
    `whn`.`COMPANY_ID` AS `COMPANY_ID`,
    `whn`.`DIVISION_ID` AS `DIVISION_ID`,
    `whn`.`DEPARTMENT_ID` AS `DEPARTMENT_ID`,
    `whn`.`SECTION_ID` AS `SECTION_ID`,
    `whn`.`EMP_CATEGORY_ID` AS `EMP_CATEGORY_ID`,
    `whn`.`POSITION_ID` AS `POSITION_ID`,
    `whn`.`LEVEL_ID` AS `LEVEL_ID`,
    `whn`.`WORK_FROM` AS `WORK_FROM`,
    `whn`.`WORK_TO` AS `WORK_TO`,
    `whn`.`NOMOR_SK` AS `NOMOR_SK`,
    `whn`.`TANGGAL_SK` AS `TANGGAL_SK`,
    `whn`.`HISTORY_GROUP` AS `HISTORY_GROUP`,
    `whn`.`HISTORY_TYPE` AS `HISTORY_TYPE`,
    `whn`.`GRADE_LEVEL_ID` AS `GRADE_LEVEL_ID`
  FROM
    `hr_work_history_now` `whn`
  WHERE `whn`.`HISTORY_GROUP` <> 1
    AND `whn`.`HISTORY_TYPE` IN (0, 1))
  UNION
  (SELECT
    0 AS `WORK_HISTORY_NOW_ID`,
    `emp`.`EMPLOYEE_ID` AS `EMPLOYEE_ID`,
    `emp`.`COMPANY_ID` AS `COMPANY_ID`,
    `emp`.`DIVISION_ID` AS `DIVISION_ID`,
    `emp`.`DEPARTMENT_ID` AS `DEPARTMENT_ID`,
    `emp`.`SECTION_ID` AS `SECTION_ID`,
    `emp`.`EMP_CATEGORY_ID` AS `EMP_CATEGORY_ID`,
    `emp`.`POSITION_ID` AS `POSITION_ID`,
    `emp`.`LEVEL_ID` AS `LEVEL_ID`,
    IF(
      (SELECT
        MAX(
          `hairisma_bpd`.`hr_work_history_now`.`WORK_TO`
        )
      FROM
        `hr_work_history_now`
      WHERE `hairisma_bpd`.`hr_work_history_now`.`EMPLOYEE_ID` = `emp`.`EMPLOYEE_ID`
        AND `hairisma_bpd`.`hr_work_history_now`.`HISTORY_GROUP` <> 1
        AND `hairisma_bpd`.`hr_work_history_now`.`HISTORY_TYPE` IN (0, 1)) + INTERVAL 1 DAY IS NOT NULL,
      (SELECT
        MAX(
          `hairisma_bpd`.`hr_work_history_now`.`WORK_TO`
        )
      FROM
        `hr_work_history_now`
      WHERE `hairisma_bpd`.`hr_work_history_now`.`EMPLOYEE_ID` = `emp`.`EMPLOYEE_ID`
        AND `hairisma_bpd`.`hr_work_history_now`.`HISTORY_GROUP` <> 1
        AND `hairisma_bpd`.`hr_work_history_now`.`HISTORY_TYPE` IN (0, 1)) + INTERVAL 1 DAY,
      `emp`.`COMMENCING_DATE`
    ) AS `WORK_FROM`,
    CURDATE() AS `WORK_TO`,
    `emp`.`SK_NOMOR` AS `NOMOR_SK`,
    `emp`.`SK_TANGGAL` AS `TANGGAL_SK`,
    `emp`.`HISTORY_GROUP` AS `HISTORY_GROUP`,
    `emp`.`HISTORY_TYPE` AS `HISTORY_TYPE`,
    `emp`.`GRADE_LEVEL_ID` AS `GRADE_LEVEL_ID`
  FROM
    `hr_employee` `emp`) $$

DELIMITER ;


/*

 table for view data view_max_employee_edu_score 

*/

DELIMITER $$

ALTER ALGORITHM =
  UNDEFINED DEFINER = `root` @`localhost` SQL SECURITY DEFINER VIEW `view_max_employee_edu_score` AS
  (SELECT
    `emp`.`EMPLOYEE_ID` AS `EMPLOYEE_ID`,
    `emp`.`EDUCATION_ID` AS `EDUCATION_ID`,
    `edu`.`EDUCATION` AS `EDUCATION`,
    MAX(`edu`.`EDUCATION_LEVEL`) AS `MAXLEVEL`,
    `scr`.`SCORE` AS `SCORE`,
    `emp`.`END_DATE` - `emp`.`START_DATE` AS `DRS`
  FROM
    (
      (
        `hr_emp_education` `emp`
        JOIN `hr_education` `edu`
          ON (
            `edu`.`EDUCATION_ID` = `emp`.`EDUCATION_ID`
          )
      )
      JOIN `hr_education_score` `scr`
        ON (
          `scr`.`EDUCATION_ID` = `emp`.`EDUCATION_ID`
        )
    )
  WHERE `scr`.`POINT_MIN` <= `emp`.`POINT`
    AND `scr`.`POINT_MAX` >= `emp`.`POINT`
  GROUP BY `emp`.`EMPLOYEE_ID`) $$

DELIMITER;

